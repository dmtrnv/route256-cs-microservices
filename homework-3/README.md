
## Домашнее задание 3

### 1. Необходимо реализовать хранилища данных в сервисе OrderService по аналогии с тем, как это сделано было на workshop.

* Необходимо реализовать абстрактные репозитории (интерфейсы)
* Все методы абстрактных репозиториев должны быть асинхронными(возвращать `Task<>`) и потдерживать отмену (`CancellationToken`)

* Реализация репозиториев должна основываться на базе конкурентного словаря (`ConcurrentDictionary<,>`)
* Реализация репозиториев должна потдерживать отмену (`CancellationToken`)

* Список регионов: "Moscow", "StPetersburg", "Novosibirsk"

### 2. Необходимо реализовать GRPC клиент для сервиса LogisticsSimulator
* [Proto file](https://gitlab.ozon.dev/cs/classroom-8/students/practice/-/blob/master/src/Ozon.Route256.Practice.LogisticsSimulator/Proto/LogisticsSimulator.proto)

### 3. Написать бизнес логику для GRPC ручек
* Убрать все заглушки
* Связать бизнес логику с репозиториями
* При реализации метода "отмены заказа", помимо отмены у себя в хранилище, надо отменить заказ в LogisticsSimulator через GRPC

Задание со *

* Для внутренних сервисов написаны UnitTest. Написать (переписать) тесты с учетом репозитория. Тесты для самого репозитория делать не надо. Во внутренних сервисах абстрактный репозиторий следует замокать FakeItEasy / moq / и т.п.

Дедлайн: 7 октября, 23:59 (сдача) / 10 октября, 23:59 (проверка)

---

## Домашнее задание 2

### 1. Необходимо реализовать взаимодействие с SD в сервисе OrderService.
Данные из SD нужны буду на 6 неделе, когда будете проходить шардированные БД.

### 2. Необходимо реализовать ручки GRPC сервиса в OrdersService (название сервиса по желанию)

- Ручка отмены заказа
- Ручка возврата статуса заказа
- Ручка возврата списка регионов
- Ручка возврата списка заказов
- Ручка агрегации заказов по региону
- Ручка получения всех заказов клиента

#### GRPC API

- GRPC ручки должны описывать только контракты для взаимодействия. Реализация этих ручек не требуется.
- Все ручки, которые могут вернуть пустой список - должны возвращать пустой список.
- Если ручка может вернуть код NotFound - сейчас она должна возвращать именно этот код.
- Допускается добавить начальные валидации на входящие параметры и возвращать код 400 для REST запросов или StatusCode.InvalidArgument, если параметры не прошли валидацию.

### 3. Необходимо реализовать ручки для REST API в сервисе Gateway - все ручки в Gateway проксируют вызовы в соответствующие вызовы в grpc сервисы OrderService и CustomerService

- Ручка отмены заказа
- Ручка возврата статуса заказа
- Ручка возврата списка клиентов
- Ручка возврата списка регионов
- Ручка возврата списка заказов
- Ручка агрегации заказов по региону
- Ручка получения всех заказов клиента

#### REST API:

- Ручки должны отображаться в swagger.
- Количество контроллеров и способ их реализации определяется вами исходя из лучших практик, которые вам известны
- Должны вызывать соответствующие методы в сервисах OrderService и CustomerService, т.е. преобразовать REST запрос в GRPC запрос, сделать вызов, получить GRPC ответ или ошибку и преобразовать его в REST ответ.
- Кроме проксирования запросов - никаких другой логики в них быть не должно.
- Клиент для OrderService должен уметь балансировать нагрузку на разные экземпляры этого сервиса (пример как это сделать был в воркшопе).
- replicas в docker-compose использовать не нужно. Все реплики должны быть прописаны вручную.

Не допускается использовать сторонние библиотеки, кроме основного фреймворка и тех, что были задействованы на workshop.

#### Подробное поведение всех ручек описано https://hallowed-join-b37.notion.site/9a297c7d74ae4b8a93feae6d8af36531

### 5. Дополнительное задание на алмазик
- В сваггере выводится вся информация об ошибках, описание контракта ответа в случае кодов 200, 400, 500
- Для внутренних сервисов написаны UnitTest, например для классов работающих с SD, или для классов, которые выполняют дополнительные проверки (валидации). Для ручек писать тесты на данном этапе не требуется.
- Для UnitTest использовать xUnit

### 6. Контракты возвращаемых объектов:

#### Для отмены заказа:

* Статус отмены заказа - успешно отменено или нет
* Описание причны не удавшейся отмены, если отменить заказ не удалось. Если Омена успешна - поле пустое.

#### Для ручки агрегации:

* Название региона
* Количество заказов
* Общая сумма заказов
* Суммарный вес
* Количество клиентов, сделавших заказ в этом регионе

#### Данные по заказу для всех ручек.

* Id заказа
* Количество товаров в заказе
* Общая сумма заказа
* Общий вес заказа
* Тип заказа
* Дата заказа
* Откуда сделан заказа (регион)
* Статус заказа
* Имя клиента (имя и фамилия)
* Адрес доставки
* Телефон


---

## Домашнее задание 1
### Развернуть инфраструктуру сервисов

### Требуется:
- Создать репозиторий проекта в своем личном пространстве нашего гитлаба.
- Название проекта в гитлабе по вашему усмотрению.
- Дать доступ к проекту своему тьютору.
- Создать решение Ozon.Route256.Practice

### Состав решения
- Проект Ozon.Route256.Practice.OrdersService
- Проект Ozon.Route256.Practice.GatewayService
- Для обоих проектов должны быть описаны Dockerfile
- Описать файл docker-compose.yaml

### Состав docker-compose.yaml
- Сервисы на базе образов из gitlab-registry.ozon.dev
  - CustomerService
  - LogisticsSimulator
  - OrdersGenerator - в трех экземплярах и представлять разные источники WebSite, Mobile, Api
  - ServiceDiscovery
- Сервисы на базе проектов в решении
  - OrdersService - в двух экземплярах
  - GatewayService
- postgress база данных для сервиса CustomerService (customer-service-db)
- postgress база данных для сервиса OrdersService (orders)
- Инфраструктура кафки (брокеры и zookeeper)
- OrdersService должно быть 2 экземпляра

### Закомитить проект

### Конечный результат:

Присутствуют images:
- CustomerService
- OrdersService - в двух экземплярах
- GatewayService
- LogisticsSimulator
- OrderGenerator - в трех экземплярах и представлять разные источники WebSite, Mobile, Api
- ServiceDiscovery
- kafka (broker)
- zookeeper
- postgres

Корректно стартуют контейнеры:
- CustomerService
- OrderService
- GatewayService
- LogisticsSimulator
- OrdersGenerator
- ServiceDiscovery
- kafka (broker)
- zookeeper
- postgres

p.s. По желанию можно добавить в решение файл .gitlab-ci.yml с настройками конкретно для вашего проекта, которые были представлены на воркшопе.

Дедлайн: 23 сентября 23:59 (сдача) / 25 сентября 23:59 (проверка) 
